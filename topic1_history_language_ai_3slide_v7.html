
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The History of Language AI ‚Äî Staged 3‚ÄëSlide (v7)</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#0b1220; --bg2:#0f1b2e; --bg3:#111827; --bgbase:#0b0f16;
    --text:#e8eef6; --muted:#a8b3c7;
    --accent:#7dd3fc; --accent2:#fca5a5; --accent3:#c4b5fd; --accent4:#86efac; --accent5:#f9a8d4;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#0b0f16;color:var(--text);font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
  body{
    background:
      radial-gradient(1200px 800px at 20% 20%, var(--bg1), transparent 60%),
      radial-gradient(1000px 700px at 90% 10%, var(--bg2), transparent 55%),
      radial-gradient(900px 700px at 70% 90%, var(--bg3), transparent 60%),
      var(--bgbase);
    background-attachment: fixed;
    overflow:hidden;
    animation: drift 24s ease-in-out infinite alternate;
  }
  @keyframes drift{
    0%{ background-position: 20% 20%, 90% 10%, 70% 90%, 0 0; }
    100%{ background-position: 25% 25%, 86% 14%, 68% 86%, 0 0; }
  }
  .deck{height:100%;width:100%;position:relative;overflow:hidden;}
  .slide{
    position:absolute;inset:0;padding:6vh 6vw;display:flex;flex-direction:column;justify-content:center;gap:1rem;
    transition:transform .45s ease, opacity .45s ease; opacity:0; transform:translateX(40px); pointer-events:none;
  }
  .slide.active{opacity:1; transform:translateX(0); pointer-events:auto;}
  h1,h2{margin:0; line-height:1.1}
  h1{font-size: clamp(30px,6vw,62px); letter-spacing:.2px; text-shadow: 0 6px 32px rgba(0,0,0,.5)}
  h2{font-size: clamp(22px,3.6vw,36px); color:var(--accent); font-weight:600;}
  p{font-size: clamp(16px,2.1vw,22px); color:var(--text); margin:0; max-width: 90ch;}
  .muted{color:var(--muted)}
  .row{display:flex; gap:1rem; flex-wrap:wrap; align-items:center}
  .card{background:linear-gradient(180deg, rgba(255,255,255,.06),rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.1); border-radius:14px; padding:.9rem 1.1rem;}
  .grid{display:grid; gap:1rem; grid-template-columns:repeat(auto-fit,minmax(220px,1fr));}
  .icon-row{display:flex; gap:.8rem; flex-wrap:wrap; align-items:center; justify-content:center}
  .icon{width:68px; height:68px; border-radius:16px; border:1px solid rgba(255,255,255,.1); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); display:flex; align-items:center; justify-content:center; font-size:34px}
  .kbd{display:inline-block;padding:.18rem .48rem;border:1px solid rgba(255,255,255,.2);border-radius:6px;background:#0b0d11}
  .progress{position:absolute; left:0; right:0; bottom:0; height:6px; background:rgba(255,255,255,.06)}
  .bar{height:100%; width:0%; background:linear-gradient(90deg,var(--accent), var(--accent3)); transition:width .3s ease}
  .help{position:absolute; top:10px; right:14px; font-size:13px; color:var(--muted)}
  .help .kbd{margin-left:.4rem}
  .counter{position:absolute; bottom:10px; right:12px; font-size:12px; color:var(--muted); background:rgba(0,0,0,.25); padding:.28rem .5rem; border-radius:8px; border:1px solid rgba(255,255,255,.1)}

  /* term popovers */
  .term{border-bottom:1px dashed rgba(255,255,255,.35); cursor:help; position:relative}
  .term:focus{outline:none}
  .popover{
    position:absolute; z-index:10; max-width:48ch; background:rgba(10,13,20,.95); color:var(--text);
    border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:.9rem 1rem; line-height:1.35;
    box-shadow: 0 10px 30px rgba(0,0,0,.45);
    transform:translateY(-6px); opacity:0; pointer-events:none; transition:opacity .15s ease, transform .15s ease;
  }
  .popover.visible{opacity:1; transform:translateY(0); pointer-events:auto}
  .svg-wrap{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.1); border-radius:16px; padding:1rem}
  svg{width:100%; height:auto}
  .pill{display:inline-block; padding:.35rem .6rem; border-radius:999px; font-size:.85em; border:1px solid rgba(255,255,255,.2);}
  .hidden{display:none !important}
  .fade{opacity:0; transform:translateY(6px); transition:.3s ease}
  .fade.show{opacity:1; transform:none}

  /* Tabs (Slide 2) */
  .tabs{display:flex; gap:.6rem; flex-wrap:wrap}
  .tab{padding:.45rem .8rem; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); cursor:pointer; font-size:.95em}
  .tab.active{outline:2px solid rgba(125,211,252,.45);}
  .pane{display:none; margin-top:.6rem}
  .pane.active{display:block; animation: fadeIn .25s ease}
  @keyframes fadeIn{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}

  /* BoW animation */
  .tile{fill:rgba(125,211,252,.18);stroke:#7dd3fc}
  .drop{animation: fall 1.6s ease-in forwards}
  @keyframes fall{from{transform:translateY(-120px)} to{transform:translateY(0)}}
  .counter-box{font-size:clamp(18px,2.4vw,26px); color:#cfe8ff}

  /* Slide 3 timeline animation */
  .ticker{position:relative; height:8px; background:rgba(255,255,255,.08); border-radius:6px; overflow:hidden; margin:.6rem 0 1rem 0}
  .tickbar{position:absolute; left:0; top:0; bottom:0; width:0%; background:linear-gradient(90deg,var(--accent), var(--accent2)); animation: tick 14s linear infinite}
  @keyframes tick{0%{width:0%} 100%{width:100%}}

  /* Modal quiz */
  .modal{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center;}
  .modal.open{display:flex}
  .modal .box{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.12); border-radius:14px; padding:1.2rem 1.4rem; width:min(720px,92vw)}
  .modal .actions{display:flex; gap:.6rem; margin-top:.8rem; flex-wrap:wrap}
  .btn{display:inline-block; padding:.55rem .9rem; border-radius:10px; border:1px solid rgba(125,211,252,.35); background:rgba(125,211,252,.16); color:var(--text); text-decoration:none; cursor:pointer}
  .btn.secondary{border-color: rgba(196,181,253,.4); background: rgba(196,181,253,.14)}

  /* Slide 1 tip (new) */
  .tip{font-size:.8em; color:var(--muted); position:absolute; bottom:14px; left:50%; transform:translateX(-50%); text-align:center; opacity:.85}

  @media print {
    body{ animation: none !important; background-attachment: initial; }
    .deck{height:auto}
    .slide{position:relative; opacity:1 !important; transform:none !important; page-break-after: always; padding:4rem 2.5rem}
    .help,.progress,.counter,.nav{display:none !important}
    .popover{display:none !important}
    .term{border-bottom:none}
  }
</style>
</head>
<body>
<div class="deck" id="deck" aria-live="polite">
  <div class="help muted">Use <span class="kbd">‚Üê</span><span class="kbd">‚Üí</span> or click/tap ‚Ä¢ <span class="kbd">F</span> full screen</div>
  <div class="counter" id="counter" aria-live="polite">1 / 3</div>

  <!-- SLIDE 1: staged reveals -->
  <section class="slide active" data-slide="1" data-steps="5" data-step="1">
    <h1 class="title">The History of Language AI</h1>

    <p id="s1-ai" class="fade hidden">AI is about systems that can <span class="term" tabindex="0" data-definition="Artificial Intelligence (AI): the field of computer science focused on building systems that can learn, reason, and solve problems.">understand</span>, <span class="term" tabindex="0" data-definition="Reasoning: using information to reach conclusions or make decisions.">reason</span>, and <span class="term" tabindex="0" data-definition="Learning: improving performance by adjusting many small internal settings (weights) after seeing lots of examples.">learn</span>.</p>

    <p id="s1-lai" class="fade hidden"><strong>Language AI</strong> helps computers read, write, and understand human language.</p>

    <div id="s1-spark" class="row fade hidden" style="justify-content:flex-start;">
      <div class="card" style="min-width:200px; text-align:center;">
        <div style="font-size:36px;">üí¨</div>
        <div class="muted">ChatGPT: 1M users in 5 days (2022)</div>
      </div>
      <div class="card" style="min-width:200px; text-align:center;">
        <div style="font-size:36px;">üì∫</div>
        <div class="muted">Netflix: ~3.5 years</div>
      </div>
      <div class="card" style="min-width:200px; text-align:center;">
        <div style="font-size:36px;">üì∏</div>
        <div class="muted">Instagram: ~2.5 months</div>
      </div>
    </div>

    <div id="s1-timeline" class="svg-wrap fade hidden">
      <svg viewBox="0 0 1200 200" role="img" aria-label="Mini timeline">
        <defs>
          <style>
            .axis{stroke:#94a3b8;stroke-width:2}
            .label{fill:#cbd5e1; font: 14px Poppins, sans-serif}
          </style>
        </defs>
        <line x1="60" y1="150" x2="1140" y2="150" class="axis"/>
        <g class="label">
          <text x="120" y="175">2000s</text>
          <text x="440" y="175">2013</text>
          <text x="700" y="175">2017</text>
          <text x="1020" y="175">2020s</text>
        </g>
        <g>
          <a xlink:href="#slide=2&tab=bow"><circle cx="180" cy="100" r="34" fill="rgba(148,163,184,.25)" stroke="#94a3b8"/></a>
          <text x="180" y="105" text-anchor="middle" fill="#e5e7eb" font-family="Poppins" font-size="14">BoW</text>
        </g>
        <g>
          <a xlink:href="#slide=2&tab=w2v"><circle cx="480" cy="85" r="34" fill="rgba(125,211,252,.22)" stroke="#7dd3fc"/></a>
          <text x="480" y="90" text-anchor="middle" fill="#e5e7eb" font-family="Poppins" font-size="14">word2vec</text>
        </g>
        <g>
          <a xlink:href="#slide=2&tab=attn"><circle cx="740" cy="100" r="34" fill="rgba(253,186,116,.22)" stroke="#fdba74"/></a>
          <text x="740" y="105" text-anchor="middle" fill="#e5e7eb" font-family="Poppins" font-size="14">Attention</text>
        </g>
        <g>
          <rect x="980" y="70" width="170" height="38" rx="10" fill="rgba(252,165,165,.22)" stroke="#fca5a5"/>
          <text x="1065" y="95" text-anchor="middle" fill="#e5e7eb" font-family="Poppins" font-size="14">Transformers ‚Üí LLMs</text>
        </g>
      </svg>
    </div>

    <p class="tip">Tip: click/tap to reveal each step ‚Ä¢ use arrows to navigate</p>
  </section>

  <!-- SLIDE 2: Methods (Tabbed) with staged reveals in BoW & w2v -->
  <section class="slide" data-slide="2" data-steps="1" data-step="1">
    <h2>How machines learned language</h2>
    <div class="tabs" role="tablist" aria-label="Language AI methods">
      <button class="tab active" data-tab="bow" role="tab" aria-selected="true">Bag‚Äëof‚Äëwords</button>
      <button class="tab" data-tab="w2v" role="tab" aria-selected="false">word2vec</button>
      <button class="tab" data-tab="attn" role="tab" aria-selected="false">Attention</button>
    </div>

    <!-- BoW pane -->
    <div class="pane active" id="pane-bow" role="tabpanel" aria-labelledby="bow" data-steps="2" data-step="1">
      <div class="row">
        <div class="svg-wrap" style="flex:1;min-width:260px;">
          <svg id="bow-svg" viewBox="0 0 600 260" role="img" aria-label="Words dropping into a bag">
            <defs>
              <linearGradient id="bag" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#374151"/><stop offset="100%" stop-color="#1f2937"/>
              </linearGradient>
            </defs>
            <rect x="200" y="120" width="220" height="110" rx="18" fill="url(#bag)" stroke="#94a3b8"/>
            <rect x="220" y="100" width="180" height="28" rx="12" fill="#111827" stroke="#94a3b8"/>
            <!-- tiles start above, drop on play -->
            <g id="w1" class=""><rect class="tile" x="120" y="10" width="80" height="28" rx="6"/><text x="160" y="30" text-anchor="middle" fill="#e5e7eb" font-size="13">dog</text></g>
            <g id="w2" class=""><rect class="tile" x="420" y="-5" width="90" height="28" rx="6"/><text x="465" y="15" text-anchor="middle" fill="#e5e7eb" font-size="13">bites</text></g>
            <g id="w3" class=""><rect class="tile" x="70" y="-20" width="90" height="28" rx="6"/><text x="115" y="0" text-anchor="middle" fill="#e5e7eb" font-size="13">man</text></g>
          </svg>
        </div>
        <div class="card" style="flex:1;min-width:260px;">
          <div id="bow-idea" class="fade">üí° <strong>Idea:</strong> Count each word ‚Äî ignore order.</div>
          <div id="bow-limit" class="fade hidden">‚ö†Ô∏è <strong>Limitation:</strong> No meaning or order ‚Äî <em>‚Äúdog bites man‚Äù</em> ‚âà <em>‚Äúman bites dog.‚Äù</em></div>
          <div class="counter-box"><span id="bow-count">0</span> words counted</div>
        </div>
      </div>
    </div>

    <!-- word2vec pane -->
    <div class="pane" id="pane-w2v" role="tabpanel" aria-labelledby="w2v" data-steps="2" data-step="1">
      <div class="row">
        <div class="svg-wrap" style="flex:1;min-width:260px;">
          <svg viewBox="0 0 600 260" role="img" aria-label="word2vec scatter plot">
            <defs>
              <style>
                .pt{fill:rgba(196,181,253,.35);stroke:#c4b5fd}
                .move{animation: driftPt 4s ease-in-out infinite alternate}
                @keyframes driftPt{from{transform:translate(0,0)} to{transform:translate(6px,-6px)}}
              </style>
            </defs>
            <circle class="pt move" cx="140" cy="200" r="6"/><text x="150" y="200" fill="#e5e7eb" font-size="12">king</text>
            <circle class="pt move" cx="170" cy="180" r="6" style="animation-delay:.2s"/><text x="180" y="180" fill="#e5e7eb" font-size="12">queen</text>
            <circle class="pt move" cx="120" cy="160" r="6" style="animation-delay:.4s"/><text x="130" y="160" fill="#e5e7eb" font-size="12">man</text>
            <circle class="pt move" cx="200" cy="155" r="6" style="animation-delay:.6s"/><text x="210" y="155" fill="#e5e7eb" font-size="12">woman</text>
            <circle class="pt move" cx="420" cy="80" r="6"/><text x="430" y="80" fill="#e5e7eb" font-size="12">apple</text>
            <circle class="pt move" cx="460" cy="90" r="6" style="animation-delay:.2s"/><text x="470" y="90" fill="#e5e7eb" font-size="12">banana</text>
            <circle class="pt move" cx="430" cy="120" r="6" style="animation-delay:.4s"/><text x="440" y="120" fill="#e5e7eb" font-size="12">orange</text>
          </svg>
        </div>
        <div class="card" style="flex:1;min-width:260px;">
          <div id="w2v-idea" class="fade">üí° <strong>Idea:</strong> Use <span class="term" tabindex="0" data-definition="A neural network is a computer system inspired by the brain. It learns patterns by adjusting many small internal settings (weights) after seeing lots of examples.">neural networks</span> to map words to <span class="term" tabindex="0" data-definition="Embedding (vector): a list of numbers that represents meaning. Words used in similar ways have similar embeddings.">embeddings</span> ‚Äî similar words sit near each other.</div>
          <div id="w2v-limit" class="fade hidden">‚ö†Ô∏è <strong>Limitation:</strong> Meaning changes with <span class="term" tabindex="0" data-definition="Context: the surrounding words and ideas that give meaning to a word or sentence.">context</span>; long sentences are hard.</div>
        </div>
      </div>
    </div>

    <!-- Attention pane -->
    <div class="pane" id="pane-attn" role="tabpanel" aria-labelledby="attn">
      <div class="row">
        <div class="svg-wrap" style="flex:1;min-width:260px;">
          <svg viewBox="0 0 700 180" role="img" aria-label="Attention spotlight over a sentence">
            <defs>
              <style>
                .word{fill:#e5e7eb; font:16px Poppins, sans-serif}
                .spot{fill:rgba(125,211,252,.18); stroke:#7dd3fc}
                @keyframes slideSpot{0%{transform:translateX(0)} 50%{transform:translateX(240px)} 100%{transform:translateX(380px)}}
              </style>
            </defs>
            <rect class="spot" x="20" y="60" width="120" height="40" rx="12" style="animation:slideSpot 5s ease-in-out infinite alternate"/>
            <text class="word" x="30" y="85">The</text>
            <text class="word" x="70" y="85">bank</text>
            <text class="word" x="120" y="85">by</text>
            <text class="word" x="150" y="85">the</text>
            <text class="word" x="185" y="85">river</text>
            <text class="word" x="240" y="85">was</text>
            <text class="word" x="280" y="85">busy</text>
            <text class="word" x="330" y="85">on</text>
            <text class="word" x="360" y="85">Monday.</text>
          </svg>
        </div>
        <div class="card" style="flex:1;min-width:260px;">
          <p>üí° <strong>Idea:</strong> A movable <span class="term" tabindex="0" data-definition="Attention: a mechanism that lets the model focus on the most relevant words when understanding or generating text ‚Äî like a movable spotlight over a sentence.">spotlight</span> focuses on key words.</p>
          <p><strong>Breakthrough:</strong> <em>Attention Is All You Need</em> (2017) introduced the <span class="term" tabindex="0" data-definition="Transformer: a model architecture built around attention. It can understand relationships between words efficiently and in parallel; it‚Äôs the foundation of modern LLMs like GPT and BERT.">Transformer</span> ‚Äî the base of modern LLMs, including ChatGPT.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- SLIDE 3: staged reveals -->
  <section class="slide" data-slide="3" data-steps="4" data-step="1">
    <h2>From counting words ‚Üí understanding context</h2>

    <div id="s3-graphic" class="hidden">
      <div class="icon-row" aria-hidden="true" style="margin:.3rem 0;">
        <div class="icon" title="Bag-of-words">üß∫</div>
        <div class="icon" title="Embeddings">üó∫Ô∏è</div>
        <div class="icon" title="Attention">üî¶</div>
        <div class="icon" title="Transformer">üß©</div>
        <div class="icon" title="ChatGPT">üí¨</div>
      </div>
      <div class="ticker"><div class="tickbar"></div></div>
    </div>

    <div id="s3-summary" class="grid hidden">
      <div class="card"><strong>Bag‚Äëof‚Äëwords</strong> ‚Ä¢ counts words</div>
      <div class="card"><strong>word2vec</strong> ‚Ä¢ vectors capture meaning</div>
      <div class="card"><strong>Attention/Transformers</strong> ‚Ä¢ understand context</div>
    </div>

    <div id="s3-teaser" class="card hidden">
      <p><strong>Next: ‚ÄúInside a Language Model.‚Äù</strong> We‚Äôll open the black box: tokens, embeddings, attention heads, and layers working together.</p>
    </div>
  </section>

  <div class="progress"><div class="bar" id="bar"></div></div>
  <div class="nav" aria-label="Slide controls" style="position:absolute; bottom:10px; left:50%; transform:translateX(-50%); display:flex; gap:.6rem;">
    <button id="prevBtn" class="btn" title="Previous (or swipe right)">‚óÄ Prev</button>
    <button id="nextBtn" class="btn" title="Next (or swipe left)">Next ‚ñ∂</button>
    <button id="quizBtn" class="btn secondary hidden" title="Quiz">Quiz</button>
    <button id="pdfBtn" class="btn secondary hidden" onclick="window.print()">Download PDF</button>
  </div>
</div>

<!-- Modal quiz -->
<div id="quizModal" class="modal" role="dialog" aria-modal="true" aria-label="Quick quiz">
  <div class="box">
    <h2 style="margin-bottom:.4rem;">Quick quiz</h2>
    <p>Which method addressed the ‚Äúcontext‚Äù problem most effectively?</p>
    <div class="actions">
      <button class="btn" data-answer="bow">Bag‚Äëof‚Äëwords</button>
      <button class="btn" data-answer="w2v">word2vec</button>
      <button class="btn" data-answer="attn">Attention / Transformers</button>
      <button class="btn secondary" id="closeQuiz">Close</button>
    </div>
    <p id="quizFeedback" class="muted" style="margin-top:.6rem;"></p>
  </div>
</div>

<script>
// Slide system with per-slide staged reveals + tabbed steps + BoW animation + quiz (same as v5, plus small Slide 1 tip)
(function(){
  const slides = Array.from(document.querySelectorAll('.slide'));
  const bar = document.getElementById('bar');
  const counter = document.getElementById('counter');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const quizBtn = document.getElementById('quizBtn');
  const pdfBtn  = document.getElementById('pdfBtn');
  let index = 0;

  function setHash(slideIdx){
    const params = new URLSearchParams(location.hash.replace('#',''));
    params.set('slide', slideIdx+1);
    location.hash = '#'+params.toString();
  }

  function show(i){
    index = Math.max(0, Math.min(i, slides.length-1));
    slides.forEach((s,idx)=>s.classList.toggle('active', idx===index));
    bar.style.width = ((index+1)/slides.length*100)+'%';
    counter.textContent = (index+1) + ' / ' + slides.length;
    setHash(index);
    // apply current reveal state for this slide
    applyReveal(slides[index], parseInt(slides[index].getAttribute('data-step')||'1',10));
  }

  function stepForward(){
    const slide = slides[index];
    const max = parseInt(slide.getAttribute('data-steps')||'1',10);
    let step = parseInt(slide.getAttribute('data-step')||'1',10);
    if(step < max){
      step++;
      slide.setAttribute('data-step', step);
      applyReveal(slide, step);
      return true;
    }
    return false;
  }

  function stepBack(){
    const slide = slides[index];
    const step = parseInt(slide.getAttribute('data-step')||'1',10);
    if(step > 1){
      slide.setAttribute('data-step', step-1);
      applyReveal(slide, step-1);
      return true;
    }
    return false;
  }

  function applyReveal(slide, step){
    const sIdx = parseInt(slide.getAttribute('data-slide'),10);
    if(sIdx===1){
      const items = [null, document.getElementById('s1-ai'), document.getElementById('s1-lai'), document.getElementById('s1-spark'), document.getElementById('s1-timeline')];
      for(let k=2;k<=5;k++){
        const el = items[k-1]; if(!el) continue;
        if(k<=step){ el.classList.remove('hidden'); requestAnimationFrame(()=>el.classList.add('show')); }
        else { el.classList.add('hidden'); el.classList.remove('show'); }
      }
    }
    if(sIdx===3){
      const g = document.getElementById('s3-graphic');
      const sum = document.getElementById('s3-summary');
      const teaser = document.getElementById('s3-teaser');
      if(step>=2){ g.classList.remove('hidden'); } else { g.classList.add('hidden'); }
      if(step>=3){ sum.classList.remove('hidden'); } else { sum.classList.add('hidden'); }
      if(step>=4){ teaser.classList.remove('hidden'); quizBtn.classList.remove('hidden'); pdfBtn.classList.remove('hidden'); }
      else { teaser.classList.add('hidden'); quizBtn.classList.add('hidden'); pdfBtn.classList.add('hidden'); }
    }
  }

  function next(){
    // Slide 2 tabbed steps first
    if(index===1){ if(handleSlide2Step()) return; }
    if(!stepForward()){ show(index+1); }
  }
  function prev(){
    if(index===1){ if(handleSlide2Back()) return; }
    if(!stepBack()){ show(index-1); }
  }

  // Click to advance (ignore interactive)
  document.addEventListener('click', (e)=>{
    const tag = e.target.tagName.toLowerCase();
    if(['button','a','input','label','select','textarea'].includes(tag) || e.target.closest('.term') || e.target.closest('.modal')) return;
    next();
  });

  // Keyboard
  window.addEventListener('keydown', (e)=>{
    if(e.key==='ArrowRight' || e.key==='PageDown' || e.key===' '){ e.preventDefault(); next(); }
    if(e.key==='ArrowLeft'  || e.key==='PageUp'   || e.key==='Backspace'){ e.preventDefault(); prev(); }
    if(e.key.toLowerCase()==='f'){ document.fullscreenElement ? document.exitFullscreen() : document.body.requestFullscreen().catch(()=>{}); }
  });
  prevBtn.addEventListener('click', prev);
  nextBtn.addEventListener('click', next);

  // Init from hash
  function initFromHash(){
    const params = new URLSearchParams(location.hash.replace('#',''));
    const s = parseInt(params.get('slide')||'1',10)-1;
    show(isNaN(s)?0:s);
    // Tabs
    const tab = params.get('tab'); if(tab){ activateTab(tab); }
  }
  window.addEventListener('hashchange', initFromHash);

  // Popovers
  function makePopover(el){
    const text = el.getAttribute('data-definition'); if(!text) return;
    let pop = document.createElement('div'); pop.className='popover'; pop.innerHTML = text; el.appendChild(pop);
    pop.style.left = '0px'; pop.style.top  = '1.6em'; requestAnimationFrame(()=>pop.classList.add('visible'));
    function close(ev){ if(!pop.contains(ev.target) && ev.target!==el){ pop.remove(); cleanup(); } }
    function esc(ev){ if(ev.key==='Escape'){ pop.remove(); cleanup(); } }
    function cleanup(){ document.removeEventListener('click', close); window.removeEventListener('keydown', esc); }
    document.addEventListener('click', close); window.addEventListener('keydown', esc);
  }
  function togglePopover(e){
    const el = e.currentTarget;
    const existing = el.querySelector('.popover');
    if(existing){ existing.remove(); return; }
    makePopover(el);
  }
  document.querySelectorAll('.term').forEach(el=>{
    el.addEventListener('click', togglePopover);
    el.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); togglePopover(e); } });
  });

  // Tabs and per-tab staged reveals on Slide 2
  const tabs = document.querySelectorAll('.tab');
  const panes = {
    bow: document.getElementById('pane-bow'),
    w2v: document.getElementById('pane-w2v'),
    attn: document.getElementById('pane-attn')
  };
  function activateTab(name){
    tabs.forEach(t=>{
      const active = t.dataset.tab===name;
      t.classList.toggle('active', active);
      t.setAttribute('aria-selected', active ? 'true':'false');
    });
    Object.keys(panes).forEach(k=> {
      panes[k].classList.toggle('active', k===name);
      if(k===name){ panes[k].setAttribute('data-step','1'); } // reset step
    });
    const params = new URLSearchParams(location.hash.replace('#',''));
    params.set('slide', 2); params.set('tab', name); location.hash = '#'+params.toString();
    if(name==='bow') playBoW();
  }
  tabs.forEach(t=> t.addEventListener('click', ()=> activateTab(t.dataset.tab)));

  function handleSlide2Step(){
    const params = new URLSearchParams(location.hash.replace('#',''));
    const tab = params.get('tab') || (document.querySelector('.tab.active')?.dataset.tab || 'bow');
    const pane = panes[tab];
    const max = parseInt(pane.getAttribute('data-steps')||'1',10);
    let step = parseInt(pane.getAttribute('data-step')||'1',10);
    if(step < max){
      step++;
      pane.setAttribute('data-step', step);
      if(tab==='bow'){
        document.getElementById('bow-limit').classList.remove('hidden');
        requestAnimationFrame(()=>document.getElementById('bow-limit').classList.add('show'));
      }
      if(tab==='w2v'){
        document.getElementById('w2v-limit').classList.remove('hidden');
        requestAnimationFrame(()=>document.getElementById('w2v-limit').classList.add('show'));
      }
      return true;
    }
    return false;
  }
  function handleSlide2Back(){
    const params = new URLSearchParams(location.hash.replace('#',''));
    const tab = params.get('tab') || (document.querySelector('.tab.active')?.dataset.tab || 'bow');
    const pane = panes[tab];
    let step = parseInt(pane.getAttribute('data-step')||'1',10);
    if(step>1){
      step--; pane.setAttribute('data-step', step);
      if(tab==='bow'){ document.getElementById('bow-limit').classList.add('hidden'); document.getElementById('bow-limit').classList.remove('show'); }
      if(tab==='w2v'){ document.getElementById('w2v-limit').classList.add('hidden'); document.getElementById('w2v-limit').classList.remove('show'); }
      return true;
    }
    return false;
  }

  // BoW animation + counter
  function playBoW(){
    const w1 = document.getElementById('w1'), w2 = document.getElementById('w2'), w3 = document.getElementById('w3');
    [w1,w2,w3].forEach((g,i)=>{ g.classList.remove('drop'); void g.offsetWidth; g.classList.add('drop'); g.style.animationDelay = (i*0.2)+'s'; });
    const counterEl = document.getElementById('bow-count');
    let n = 0; const target = 314;
    clearInterval(counterEl._timer);
    counterEl._timer = setInterval(()=>{
      n += Math.ceil((target - n)/12);
      if(n>=target){ n=target; clearInterval(counterEl._timer); }
      counterEl.textContent = n.toString();
    }, 80);
  }
  // Observe pane changes
  const obs = new MutationObserver(()=>{ if(panes.bow.classList.contains('active')) playBoW(); });
  obs.observe(panes.bow, {attributes:true, attributeFilter:['class']});
  window.addEventListener('load', ()=>{ if(panes.bow.classList.contains('active')) playBoW(); });

  // Quiz modal
  const quizModal = document.getElementById('quizModal');
  const quizFeedback = document.getElementById('quizFeedback');
  document.getElementById('closeQuiz').addEventListener('click', ()=> quizModal.classList.remove('open'));
  quizBtn.addEventListener('click', ()=> quizModal.classList.add('open'));
  quizModal.addEventListener('click', (e)=>{ if(e.target===quizModal) quizModal.classList.remove('open'); });
  document.querySelectorAll('.modal .actions .btn').forEach(b=>{
    const ans = b.getAttribute('data-answer'); if(!ans) return;
    b.addEventListener('click', ()=>{
      if(ans==='attn'){ quizFeedback.textContent = 'Correct! Attention (Transformers) solved context by focusing on the most relevant words.'; }
      else { quizFeedback.textContent = 'Not quite. Bag‚Äëof‚Äëwords counts; word2vec captures meaning; but Attention tackles context directly.'; }
    });
  });

  // Init
  function initFromHash(){
    const params = new URLSearchParams(location.hash.replace('#',''));
    const s = parseInt(params.get('slide')||'1',10)-1;
    show(isNaN(s)?0:s);
    const tab = params.get('tab'); if(tab){ activateTab(tab); }
  }
  initFromHash();
})();
</script>
</body>
</html>
